Tropic Trooper’s New Strategy
by Jaromir Horejsi, Joey Chen, and Joseph C. Chen
Tropic Trooper (also known as KeyBoy) levels its campaigns against Taiwanese, Philippine, and Hong Kong targets, focusing on their government, healthcare, transportation, and high-tech industries. Its operators are believed to be very organized and develop their own cyberespionage tools that they fine-tuned in their recent campaigns. Many of the tools they use now feature new behaviors, including a change in the way they maintain a foothold in the targeted network.
Attack Chain

Figure 1. Attack chain of Tropic Trooper’s operations
Here’s a summary of the attack chain of Tropic Trooper’s recent campaigns:
We also observed malicious documents that don’t need to download anything from the internet as the backdoor’s dropper is already embedded in the document. This, however, doesn’t influence the overall result for the victim.
The backdoor will load the encrypted configuration file and decrypt it, then use Secure Sockets Layer (SSL) protocol to connect to command-and-control (C&C) servers.
Tropic Trooper uses exploit-laden Microsoft Office documents to deliver malware to targets. These documents use job vacancies in organizations that may be deemed socio-politically sensitive to recipients. Below is a screenshot of the document used in their latest campaigns:

Figure 2. Malicious document used by Tropic Trooper
PDB Strings as Context Clues
The MSI file has two program database (PDB) strings inside: one belonging to the MSI file, and another for the backdoor installer (detected by Trend Micro as TROJ_TCDROP.ZTFB).

Figure 3. PDB strings inside the MSI file
The first PDB string has a certain ss2/Projects/MsiWrapper (Project MsiWrapper) in it, which we found to be an open-source application that converts executable setup programs to MSI files. The second PDB string contains Work, House, and TSSL: we can assume this tool belongs to Tropic Trooper’s TSSL project as seen by other researchers. Here it is a new one, as seen in their misspelling of “Horse” to “House” (other reports had the string typed correctly).
Another interesting PDB string we found is D:\Work\Project\VS\house\Apple\Apple_20180115\Release\InstallClient.pdb. At installation, the MSI file drops three files and creates one hidden directory (UFile) into C:\ProgramData\Apple\Update\, likely as a ruse.
It would then use sidebar.exe to load the malicious wab32res.dll (TROJ_TCLT.ZDFB) through DLL hijacking. This is carried out to evade antivirus (AV) detection, because wab32res.dll is loaded by a benign file.

Figure 4. The installer drops three files into the Apple/Update directory


Figure 5. PDB strings inside the loader file
From the PDB string above, the attackers intended it to be a loader (hence the name FakeRun) and not the actual backdoor. FakeRun’s PDB string (D:\Work\Project\VS\house\Apple\Apple_20180115\Release\FakeRun.pdb) indicates the loader will execute dllhost.exe and inject one malicious DLL file, which is the backdoor, into this process. The backdoor, TClient (BKDR_TCLT.ZDFB), is so named from its own PDB string.

Figure 6. TClient is injected into dllhost.exe
Malware Analysis 
wab32res.dll (FakeRun loader) loads TClient. Once the loader is executed, it will check the current process (sidebar.exe) whether to load it or not. Successfully checking the loader will execute the dllhost.exe process and create a hardcode mutex to avoid injecting it into the wrong dllhost.exe, as there can be multiple instances of it depending on the number of programs using the Internet Information Services.

Figure 7. The loader checking the sidebar process

Figure 8. The malicious loader injecting the backdoor into dllhost.exe

Figure 9. Comparison of TClient’s configuration format in 2016 (left, from other researchers) and 2018 (right)
TClient will use SSL to connect to Tropic Trooper’s C&C server. However, the C&C server and some configuration values are not hardcoded in the backdoor. This allows Tropic Trooper’s operators to easily change/update the C&C server and configure other values.
TClient is actually one of Tropic Trooper’s other backdoors. The backdoor noted by other security researchers was encoded with different algorithms and configured with different parameter names in 2016, for instance. TClient uses symmetric encryption to decrypt its configuration with one 16-byte key in 2018. The image and table below illustrate TClient’s encrypted configuration that we decrypted (via Python code):

Figure 10. Snapshot of code we used to decrypt TClient’s configuration


Figure 11. Encrypted backdoor configuration
Figure 12. Decrypted backdoor configuration
Reverse analysis of TClient allowed us to determine how to decrypt the C&C information. TClient will use custom SSL libraries to connect the C&C server. We also found another SSL certificate on this C&C server. A closer look reveals that it was registered quite recently, and is set to expire after a year, suggesting Tropic Trooper’s use or abuse of components or services that elapse so they can leave as few traces as possible.

Figure 13. SSL certificate’s validity
Following Tropic Trooper’s Trails 
We further monitored their activities and found three additional and notable PDB strings in their malware:
These came from open-intelligence platforms and incident response cases. These strings shed further light on Tropic Trooper’s operations:
The Need for a Proactive Incident Response Strategy
Cyberespionage campaigns are persistent and, as shown by Tropic Trooper, always raring to exploit weaknesses in people and technology. For organizations, this highlights the significance of staying ahead of their attackers: detect, analyze, and respond. What techniques will they use? How can my organization’s attack surface be reduced? What did I do to respond to the threat — what worked, what didn’t, and what could be fine-tuned?
A proactive incident response strategy provides threat intelligence — from the endpoint to the network — that can let IT/system administrators identify malicious activities that aren’t typically visible to traditional security solutions.
TClient, for instance, uses DLL hijacking and injection that may not be as noticeable to others. Its use of the SSL protocol also means it can blend with legitimate traffic. Analyzing their PDB strings can also provide a deeper insight into the campaign’s bigger picture. Ascertaining the tactics and techniques they use empower organizations in developing robust and actionable indicators of compromise (IoCs) that can act as benchmarks for response.
Here are some best practices that organizations can adopt:
Indicators of Compromise (IoCs):
Related Hashes (SHA-256):
Detected as CVE-2018-0802.ZTFC:
BKDR_TCLT.ZDFB:
BKDR64_TCLT.ZTFB:
TROJ_SCLT.ZTFB:
TROJ_TCDROP.ZTFB:
TROJ_TCLT.ZDFB:
URLs related to C&C communication:
